{"version":3,"file":"file.spec.cjs","sources":["../../test/file.spec.js"],"sourcesContent":["import * as lib from \"@web-std/file\"\nimport { File } from \"@web-std/file\"\nimport { assert } from \"./test.js\"\n\n/**\n * @param {import('./test').Test} test\n */\nexport const test = test => {\n  test(\"test baisc\", async () => {\n    assert.isEqual(typeof lib.Blob, \"function\")\n    assert.isEqual(typeof lib.File, \"function\")\n  })\n\n  if (globalThis.window === globalThis) {\n    test(\"uses built-ins\", async () => {\n      assert.isEqual(lib.File, globalThis.File)\n      assert.isEqual(lib.Blob, globalThis.Blob)\n    })\n  }\n\n  test(\"new File\", async () => {\n    // @ts-expect-error\n    assert.throws(() => new File(), TypeError)\n    // @ts-expect-error\n    assert.throws(() => new File([]), TypeError)\n\n    const before = Date.now()\n    await new Promise(resolve => setTimeout(resolve, 3))\n    const file = new File([\"test\"], \"name\")\n    await new Promise(resolve => setTimeout(resolve, 3))\n    const after = Date.now()\n    assert.equal(file.size, 4)\n    assert.equal(file.name, \"name\")\n    assert.equal(typeof file.lastModified, \"number\")\n    assert.equal(file.lastModified > before, true)\n    assert.equal(file.lastModified < after, true)\n    assert.equal(file.type, \"\")\n\n    const chunks = []\n    const reader = file.stream().getReader()\n    while (true) {\n      const chunk = await reader.read()\n      if (chunk.done) {\n        reader.releaseLock()\n        break\n      } else {\n        chunks.push(chunk.value)\n      }\n    }\n\n    assert.deepEqual(chunks, [new TextEncoder().encode(\"test\")])\n  })\n\n  test(\"File with lastModified\", async () => {\n    const file = new File([\"test\"], \"name\", { lastModified: 1594672000418 })\n\n    assert.equal(file.size, 4)\n    assert.equal(file.name, \"name\")\n    assert.equal(file.lastModified, 1594672000418)\n    assert.equal(file.type, \"\")\n  })\n\n  test(\"File with type\", async () => {\n    const file = new File([\"test\"], \"name\", {\n      lastModified: 1594672000418,\n      type: \"text/plain\",\n    })\n\n    assert.equal(file.size, 4)\n    assert.equal(file.name, \"name\")\n    assert.equal(file.lastModified, 1594672000418)\n    assert.equal(file.type, \"text/plain\")\n  })\n\n  test(\"File type is normalized\", async () => {\n    const file = new File([\"test\"], \"name\", {\n      type: \"Text/Plain\",\n    })\n\n    assert.equal(file.size, 4)\n    assert.equal(file.name, \"name\")\n    assert.equal(file.type, \"text/plain\")\n  })\n\n  test(\"File name is (not) escaped\", async () => {\n    const file = new File([\"test\"], \"dir/name\")\n\n    assert.equal(file.size, 4)\n    // occording to spec it's former but in pratice it seems later ü§∑‚Äç‚ôÇÔ∏è\n    assert.equal(file.name === \"dir:name\" || file.name === \"dir/name\", true)\n    assert.equal(file.type, \"\")\n  })\n}\n"],"names":["assert","lib","File"],"mappings":"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"}